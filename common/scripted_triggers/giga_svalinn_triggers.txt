# Svalinn Defence Installation

# Extendable trigger that replaces is_planet_class checks
## planet scope
is_giga_svalinn_installation = {
	OR = {
		is_planet_class = pc_giga_svalinn_defense_installation
	}
}

# country/system has any of the svalinn-related megastructures (these are only present during construction)
## country or system scope
giga_has_svalinn_installation = {
	OR = {
		has_megastructure = svalinn_platform_0
		has_megastructure = svalinn_bifrost_1
		has_megastructure = svalinn_interstellar_neighbor_system_option_1
		has_megastructure = svalinn_interstellar_1
		has_megastructure = svalinn_interstellar_2
	}
}

# stars on which the svalinn *platform* can be built - can exclude stuff here
# these are just an origin system for the interstellar bastion - don't block black holes etc.
## planet scope
is_giga_svalinn_buildable_star = {
	always = yes
}

# stars on which the bifrost star collectors can be built - more than just an origin system for the interstellar bastion
## planet scope
is_giga_svalinn_bifrost_allowed_star = {
	OR = {
		giga_is_standard_star = yes # normal stars
		giga_is_superpower_star = yes # O class
		giga_is_neutron_type_star = yes # sure why not, use the neutron flux
		giga_is_white_hole = yes # easter egg: wtf are you doing with the unique white hole
	}
}

# trigger for megastructure having stars where the Bifrost part can still be built
# it's a set of platforms that collect star energy, 
# dyson sphere obviously won't work but a ringworld can
## planet scope
is_giga_svalinn_bifrost_combinable_megastructure = {
	OR = {
		# exclusions
		NOR = {
			# most megas won't work
			has_any_megastructure = yes
			has_planet_flag = has_megastructure
			has_planet_flag = megastructure
		}
		# specifically allow these exceptions
		## is solar system right?
		solar_system = {
			has_star_flag = ring_world_built
			giga_has_alderson_disk = yes
			giga_has_planetcraft_printer = yes
			giga_has_squareworld = yes
			giga_has_preservation_sphere = yes # easter egg
			AND = { 
				giga_has_neutronium_gigaforge = yes 
				# but not nidavellir
				giga_has_nidavellir_forge = no
			}
			giga_has_mega_shipyard = yes
			giga_has_mega_art_installation = yes
			giga_has_strategic_coordination_center = yes
			giga_has_interstellar_assembly = yes
		}
	}
}

# combination trigger for the upgrade as a whole
## planet scope
is_giga_svalinn_bifrost_allowed = {
	# check: the star type is fine for bifrost extraction
	is_giga_svalinn_bifrost_allowed_star = yes
	# bypass for some specific megas that are still ok to combine
	is_giga_svalinn_bifrost_combinable_megastructure = yes
}

# valid target systems where you can build an SDI halfway between that system and the one where you built the mega
## system scope
is_valid_svalinn_bastion_target = {
	always = yes
}

# the upgrade to an interstellar platform in nearby space is allowed on this star
## planet scope, must be star
is_giga_svalinn_interstellar_allowed = {
	is_star = yes
	solar_system = {
		# there are neighbors
		count_neighbor_system = {
			count > 0
		}
		# they are valid targets
		any_neighbor_system = {
			is_valid_svalinn_bastion_target = yes
		}
	}
}

